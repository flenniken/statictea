# jsondocraw.nim

Generate json data from a nim source file.


* [jsondocraw.nim](../../src/jsondocraw.nim) &mdash; Nim source code.
# Index

* const: [helpText](#helptext) &mdash; alternate doc comment when needed 
* type: [Args](#args) &mdash; Args holds the arguments specified on the command line.
* [newArgs](#newargs) &mdash; Create an Args object from a CmlArgs.
* [getMessage](#getmessage) &mdash; Return a message from a message id and problem argument.
* [`$`](#) &mdash; Return a string representation of an Args object.
* [readOneDesc](#readonedesc) &mdash; Return the doc comment found in the given range of line numbers.
* [readDescriptions](#readdescriptions) &mdash; Read all the descriptions in the file specified by the starting line numbers.
* [removePresentation](#removepresentation) &mdash; Create a json file without presentation formatting in the descriptions.

# helpText

alternate doc comment
when needed


~~~nim
helpText = """Create a json file like Nim's jsondoc command except the descriptions
match the source. This command runs Nim's jsondoc command then post
processes the data to patch the descriptions.

The jsondocraw command exists because Nim’s jsondoc command assumes
the doc comment is formatted as reStructuredText (RST) and it converts
the RST to HTML for the JSON description.

The jsondocraw command reads the description's line number in the JSON
file then reads the source file to extract the raw doc comment.

When you use markdown or some other format for your doc comments, you
are likely to specify something that causes the RST parser to fail and
no JSON is produced. When this happens you can specify an alternate doc
comment prefix as a workaround, "#$ " instead of "## ".

The leading ## is required for nim's jsondoc to record it in the
json.

proc sample*() =
  ##
  #$ alternate doc comment
  #$ when needed
  echo "tea"

Usage:
  jsondocraw [-h] [-v] srcFilename destFilename

  -h --help — show this message
  -v --version — show the version number

  srcFilename — nim source filename
  destFilename — filename of the json file to create
"""
~~~

# Args

Args holds the arguments specified on the command line.

* help — help or -h was specified
* noOptions — no options or arguments specified
* version — version or -v was specified
* srcFilename — nim source filename
* destJsonFile — name of the JSON file to create


~~~nim
Args = object
  help*: bool
  noOptions*: bool
  version*: bool
  srcFilename*: string
  destJsonFile*: string
~~~

# newArgs

Create an Args object from a CmlArgs.


~~~nim
func newArgs(cmlArgs: CmlArgs): Args {.raises: [KeyError], tags: [].}
~~~

# getMessage

Return a message from a message id and problem argument.


~~~nim
func getMessage(message: CmlMessageId; problemArg: string = ""): string {.
    raises: [ValueError], tags: [].}
~~~

# `$`

Return a string representation of an Args object.


~~~nim
func `$`(args: Args): string {.raises: [ValueError], tags: [].}
~~~

# readOneDesc

Return the doc comment found in the given range of line
numbers. The srcLines contain the line endings.


~~~nim
proc readOneDesc(srcLines: seq[string]; start: int; finish: int): string {.
    raises: [RegexError], tags: [].}
~~~

# readDescriptions

Read all the descriptions in the file specified by the starting
line numbers. Return a dictionary mapping the line number to its
description.


~~~nim
proc readDescriptions(text: string; lineNums: seq[int]): OrderedTable[string,
    string] {.raises: [RegexError], tags: [].}
~~~

# removePresentation

Create a json file without presentation formatting in the
descriptions.  Pass in a source filename and the name of the json
file to create.


~~~nim
proc removePresentation(args: Args) {.raises: [JsonDocRawError, ValueError,
    OSError, Exception, IOError, JsonParsingError, KeyError, RegexError], tags: [
    ReadDirEffect, ReadEnvEffect, ReadIOEffect, WriteDirEffect, ExecIOEffect,
    RootEffect, WriteIOEffect].}
~~~


---
⦿ Markdown page generated by [StaticTea](https://github.com/flenniken/statictea/) from nim doc comments. ⦿
