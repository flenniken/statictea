<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>templates/nimModule.tea</title>
<style>
body {
    max-width: 40em;
    font-size: 2em;
    margin-left: 1em;
}

#staticteadep {
    width: 100%;
}

.signature {
    color: green;
}

.description {
    white-space: pre-wrap;
}

pre {
//    border-left: 6px solid green;
    padding: 1em;
    background-color: #f6f8fa;
    overflow: auto;
    white-space: pre-wrap;
}

.desc-code {
    border: 1px solid blue;
    background-color: white;
}

//.t-other {
//    color: #D7381E;
//}
//.t-dotName {
//    color: #CE7923;
//}
.t-funcCall {
    color: #5F34FF;
}
.t-num {
    color: IndianRed;
}
.t-str {
    color: #34A227;
}
.t-multiline {
    color: green;
}
.t-doc {
    color: #B03B84;
}
.t-comment {
    color: #D7381E;
}
//.t-param {
//    color: red;
//}
.t-type {
    color: #D7381E;
}

</style>


</head>
<body>
<h1>templates/nimModule.tea</h1>

<pre>
<span class="t-doc">## Tea code file for use by templates nimModule.md and nimModule.html.
</span>
<span class="t-comment"># Define replacement patterns to remove formatting from the descriptions.
</span><span class="t-dotName">patterns</span> = <span class="t-funcCall">list</span>( +
  <span class="t-str">"~~~~"</span>, <span class="t-str">"~~~"</span>, +
  <span class="t-str">"@@"</span>, <span class="t-str">""</span>, +
  <span class="t-str">"@{"</span>, <span class="t-str">"["</span>, +
  <span class="t-str">"}@"</span>, <span class="t-str">"]"</span>, +
  <span class="t-str">"@!"</span>, <span class="t-str">"|"</span>, +
  <span class="t-str">"[ ]*@:"</span>, <span class="t-str">"\n"</span>, +
  <span class="t-str">"@\\."</span>, <span class="t-str">"*"</span>, +
  <span class="t-str">"&quot;"</span>, <span class="t-str">"\""</span>, +
  <span class="t-str">"&gt;"</span>, <span class="t-str">">"</span>, +
  <span class="t-str">"&lt;"</span>, <span class="t-str">"<"</span>, +
  <span class="t-str">"&amp;"</span>, <span class="t-str">"&"</span>)

<span class="t-dotName">u.handle-bullet</span> = <span class="t-funcCall">func</span>(<span class="t-param">ix</span>: <span class="t-type">int</span>, <span class="t-param">bullet</span>: <span class="t-type">string</span>, <span class="t-param">lines</span>: <span class="t-type">list</span>) <span class="t-type">bool</span>
  <span class="t-doc">## Make the bullet text into an html bullet and add it to lines.
</span>  <span class="t-dotName">lines</span> &= <span class="t-funcCall">join</span>([<span class="t-str">"<li>"</span>, <span class="t-dotName">bullet</span>, <span class="t-str">"</li>"</span>], <span class="t-str">""</span>)
  <span class="t-funcCall">return</span>(<span class="t-dotName">false</span>)

<span class="t-dotName">u.html-paragraph</span> = <span class="t-funcCall">func</span>(<span class="t-param">item</span>: <span class="t-type">list</span>) <span class="t-type">string</span>
  <span class="t-doc">## Return html given a "p" element md list.
</span>  <span class="t-funcCall">return</span>(<span class="t-funcCall">join</span>([<span class="t-str">"<p>"</span>, <span class="t-dotName">item</span>[<span class="t-num">0</span>], <span class="t-str">"</p>"</span>], <span class="t-str">""</span>))

<span class="t-dotName">u.handle-fragment</span> = <span class="t-funcCall">func</span>(<span class="t-param">ix</span>: <span class="t-type">int</span>, <span class="t-param">fragment</span>: <span class="t-type">list</span>, <span class="t-param">frags</span>: <span class="t-type">list</span>) <span class="t-type">bool</span>
  <span class="t-doc">## Make the html highlight the fragment and add it to frags.
</span>  <span class="t-dotName">tag</span> = <span class="t-dotName">fragment</span>[<span class="t-num">0</span>]
  <span class="t-dotName">str</span> = <span class="t-dotName">fragment</span>[<span class="t-num">1</span>]
  <span class="t-dotName">frags</span> &= <span class="t-funcCall">if</span>((<span class="t-dotName">tag</span> == <span class="t-str">"other"</span>), <span class="t-dotName">str</span>, +
    <span class="t-funcCall">format</span>(<span class="t-str">"<span class=\"t-{tag}\">{str}</span>"</span>))
  <span class="t-funcCall">return</span>(<span class="t-dotName">false</span>)

<span class="t-dotName">u.html-code</span> = <span class="t-funcCall">func</span>(<span class="t-param">item</span>: <span class="t-type">list</span>) <span class="t-type">string</span>
  <span class="t-doc">## Return html given a "code" md element list.
</span>  <span class="t-dotName">lines</span> = []
  <span class="t-dotName">lines</span> &= <span class="t-str">"<pre class=\"desc-code\">\n"</span>
  <span class="t-comment"># todo: look at the ~~~ line and only highlight statictea code.
</span>  <span class="t-funcCall">listLoop</span>(<span class="t-funcCall">highlight</span>(<span class="t-dotName">item</span>[<span class="t-num">1</span>]), <span class="t-dotName">lines</span>, <span class="t-dotName">u.handle-fragment</span>)
  <span class="t-dotName">lines</span> &= <span class="t-str">"</pre>\n"</span>
  <span class="t-funcCall">return</span>(<span class="t-funcCall">join</span>(<span class="t-dotName">lines</span>, <span class="t-str">""</span>))

<span class="t-dotName">u.html-bullets</span> = <span class="t-funcCall">func</span>(<span class="t-param">item</span>: <span class="t-type">list</span>) <span class="t-type">string</span>
  <span class="t-doc">## Return html given a "bullets" md element list.
</span>  <span class="t-dotName">lines</span> = []
  <span class="t-dotName">lines</span> &= <span class="t-str">"<ul>\n"</span>
  <span class="t-funcCall">listLoop</span>(<span class="t-dotName">item</span>, <span class="t-dotName">lines</span>, <span class="t-dotName">u.handle-bullet</span>)
  <span class="t-dotName">lines</span> &= <span class="t-str">"</ul>\n"</span>
  <span class="t-funcCall">return</span>(<span class="t-funcCall">join</span>(<span class="t-dotName">lines</span>, <span class="t-str">""</span>))

<span class="t-dotName">u.handle-element</span> = <span class="t-funcCall">func</span>(<span class="t-param">ix</span>: <span class="t-type">int</span>, <span class="t-param">element</span>: <span class="t-type">list</span>, <span class="t-param">lines</span>: <span class="t-type">list</span>) <span class="t-type">bool</span>
  <span class="t-doc">## Make the description md element into html and add it to lines.
</span>  <span class="t-dotName">l.fn</span> = <span class="t-funcCall">case</span>(<span class="t-dotName">element</span>[<span class="t-num">0</span>], [ +
    <span class="t-str">"p"</span>, <span class="t-dotName">u.html-paragraph</span>, +
    <span class="t-str">"code"</span>, <span class="t-dotName">u.html-code</span>, +
    <span class="t-str">"bullets"</span>, <span class="t-dotName">u.html-bullets</span> +
  ])
  <span class="t-dotName">lines</span> &= <span class="t-funcCall">l.fn</span>(<span class="t-dotName">element</span>[<span class="t-num">1</span>])
  <span class="t-funcCall">return</span>(<span class="t-dotName">false</span>)

<span class="t-dotName">u.get-html-description</span> = <span class="t-funcCall">func</span>(<span class="t-param">mdDescription</span>: <span class="t-type">string</span>) <span class="t-type">string</span>
  <span class="t-doc">## Parse the description markdown text and return html paragraphs,
</span>  <span class="t-doc">## bullet lists and code blocks.
</span>  <span class="t-dotName">elements</span> = <span class="t-funcCall">markdownLite</span>(<span class="t-dotName">mdDescription</span>)
  <span class="t-dotName">lines</span> = []
  <span class="t-funcCall">listLoop</span>(<span class="t-dotName">elements</span>, <span class="t-dotName">lines</span>, <span class="t-dotName">u.handle-element</span>)
  <span class="t-funcCall">return</span>(<span class="t-funcCall">join</span>(<span class="t-dotName">lines</span>, <span class="t-str">""</span>))

<span class="t-dotName">u.get-name</span> = <span class="t-funcCall">func</span>(<span class="t-param">ix</span>: <span class="t-type">int</span>, <span class="t-param">entry</span>: <span class="t-type">dict</span>, <span class="t-param">newList</span>: <span class="t-type">list</span>) <span class="t-type">bool</span>
  <span class="t-doc">## Add the entry name to the list.
</span>  <span class="t-dotName">newList</span> &= <span class="t-dotName">entry.name</span>
  <span class="t-funcCall">return</span>(<span class="t-dotName">false</span>)

<span class="t-comment"># Determine the template type from the template's extension.
</span><span class="t-dotName">path</span> = <span class="t-funcCall">path</span>(<span class="t-dotName">t.args.resultFilename</span>)
<span class="t-dotName">templateType</span> = <span class="t-funcCall">if</span>((<span class="t-dotName">path.ext</span> == <span class="t-str">".md"</span>), <span class="t-str">"github"</span>, <span class="t-str">"html"</span>)

<span class="t-comment"># Create the anchors for all the heading names.
</span><span class="t-dotName">names</span> = []
<span class="t-funcCall">listLoop</span>(<span class="t-dotName">s.entries</span>, <span class="t-dotName">names</span>, <span class="t-dotName">u.get-name</span>)
<span class="t-dotName">anchors</span> = <span class="t-funcCall">anchors</span>(<span class="t-dotName">names</span>, <span class="t-dotName">templateType</span>)

<span class="t-comment"># Use the filename's basename for the module name.
</span><span class="t-dotName">orig-path</span> = <span class="t-funcCall">path</span>(<span class="t-dotName">s.orig</span>)
<span class="t-dotName">o.moduleName</span> = <span class="t-dotName">orig-path.filename</span>

<span class="t-comment"># Remove the special patterns from the description resulting in
</span><span class="t-comment"># markdown.
</span><span class="t-dotName">mdDescription</span> = <span class="t-funcCall">replaceRe</span>(<span class="t-dotName">s.moduleDescription</span>, <span class="t-dotName">patterns</span>)

<span class="t-comment"># For the html template convert the markdown to html, else use the
</span><span class="t-comment"># markdown as is.
</span><span class="t-dotName">o.moduleDescription</span> = <span class="t-funcCall">if</span>((<span class="t-dotName">templateType</span> == <span class="t-str">"html"</span>), +
  <span class="t-funcCall">u.get-html-description</span>(<span class="t-dotName">mdDescription</span>), +
  <span class="t-dotName">mdDescription</span>)

<span class="t-dotName">u.get-entry</span> = <span class="t-funcCall">func</span>(<span class="t-param">ix</span>: <span class="t-type">int</span>, <span class="t-param">entry</span>: <span class="t-type">dict</span>, <span class="t-param">newList</span>: <span class="t-type">list</span>, <span class="t-param">state</span>: <span class="t-type">dict</span>) <span class="t-type">bool</span>
  <span class="t-doc">## Reformat the entry and add it to the new list.
</span>  <span class="t-dotName">newEntry</span> = <span class="t-funcCall">dict</span>()
  <span class="t-dotName">newEntry.name</span> = <span class="t-dotName">entry.name</span>

  <span class="t-comment"># Set the entry type to: type, const, macro or "".
</span>  <span class="t-dotName">cases</span> = <span class="t-funcCall">list</span>(+
    <span class="t-str">"skType"</span>, <span class="t-str">"type: "</span>, +
    <span class="t-str">"skConst"</span>, <span class="t-str">"const: "</span>, +
    <span class="t-str">"skMacro"</span>, <span class="t-str">"macro: "</span>)
  <span class="t-dotName">newEntry.type</span> = <span class="t-funcCall">case</span>(<span class="t-dotName">entry.type</span>, <span class="t-dotName">cases</span>, <span class="t-str">""</span>)

  <span class="t-comment"># Remove the formatting from the description and use the first
</span>  <span class="t-comment"># sentence for the short description.
</span>  <span class="t-dotName">descr</span> = <span class="t-funcCall">get</span>(<span class="t-dotName">entry</span>, <span class="t-str">"description"</span>, <span class="t-str">""</span>)
  <span class="t-dotName">mdDescription</span> = <span class="t-funcCall">replaceRe</span>(<span class="t-dotName">descr</span>, <span class="t-dotName">state.patterns</span>)
  <span class="t-dotName">newEntry.short</span> = <span class="t-funcCall">slice</span>(<span class="t-dotName">mdDescription</span>, <span class="t-num">0</span>, <span class="t-funcCall">add</span>(<span class="t-funcCall">find</span>(<span class="t-dotName">mdDescription</span>, <span class="t-str">"."</span>, <span class="t-num">-1</span>), <span class="t-num">1</span>))

  <span class="t-comment"># Convert the markdown description to html for the html template.
</span>  <span class="t-dotName">newEntry.description</span> = <span class="t-funcCall">if</span>((<span class="t-dotName">state.templateType</span> == <span class="t-str">"html"</span>), +
    <span class="t-funcCall">u.get-html-description</span>(<span class="t-dotName">mdDescription</span>), +
    <span class="t-dotName">mdDescription</span>)

  <span class="t-comment"># Simplify the code by removing some text.
</span>  <span class="t-dotName">junk</span> = <span class="t-str">"{.\\s*raises:\\s*\\[],\\s*tags:\\s*\\[].}"</span>
  <span class="t-dotName">code</span> = <span class="t-funcCall">replaceRe</span>(<span class="t-dotName">entry.code</span>, <span class="t-funcCall">list</span>(<span class="t-dotName">junk</span>, <span class="t-str">""</span>, <span class="t-str">"\n*\\s*$"</span>, <span class="t-str">""</span>))

  <span class="t-dotName">newEntry.signature</span> = <span class="t-dotName">code</span>
  <span class="t-dotName">newEntry.anchor</span> = <span class="t-dotName">state.anchors</span>[<span class="t-dotName">ix</span>]
  <span class="t-dotName">newList</span> &= <span class="t-dotName">newEntry</span>
  <span class="t-funcCall">return</span>(<span class="t-dotName">false</span>)

<span class="t-comment"># Reformat the server entries list and store it in o.entries.
</span><span class="t-dotName">state</span> = <span class="t-funcCall">dict</span>()
<span class="t-dotName">state.patterns</span> = <span class="t-dotName">patterns</span>
<span class="t-dotName">state.anchors</span> = <span class="t-dotName">anchors</span>
<span class="t-dotName">state.templateType</span> = <span class="t-dotName">templateType</span>
<span class="t-dotName">o.entries</span> = []
<span class="t-funcCall">listLoop</span>(<span class="t-dotName">s.entries</span>, <span class="t-dotName">o.entries</span>, <span class="t-dotName">u.get-entry</span>, <span class="t-dotName">state</span>)

</pre>

<p>⦿ This page was generated
by <a href="https://github.com/flenniken/statictea/">statictea</a>
from nim doc comments. ⦿</p>

</body>
</html>
